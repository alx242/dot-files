;; * * * Load emacs stuff * * *
(add-to-list 'load-path "~/.emacs.d/lisp")
;; Package handling
(setq package-archives '(("elpa" . "http://elpa.gnu.org/packages/")
                         ("marmalade" . "http://marmalade-repo.org/packages/")
                         ("melpa" . "http://melpa.milkbox.net/packages/")))

;; * * * General variables * * *
;; No tabs only spaces
(setq indent-tabs-mode nil)
(setq-default indent-tabs-mode nil)
(setq-default show-trailing-whitespace t)
(setq-default default-indicate-empty-lines t)
(setq-default line-number-mode t)
(setq-default column-number-mode t)

;; * * * Interactively Do Things * * *
(require 'ido)
(ido-mode t)

;; * * * Encrypted files * * *
(require 'ps-ccrypt)

;; * * * Magit - git handler * * *
(add-to-list 'load-path "~/.emacs.d/cl-lib")
(add-to-list 'load-path "~/.emacs.d/git-modes")
(add-to-list 'load-path "~/.emacs.d/magit")
(eval-after-load 'info
  '(progn (info-initialize)
          (add-to-list 'Info-directory-list "~/.emacs.d/magit")))
(require 'magit)
(require 'magit-blame)

;; * * * Yang * * *
(autoload 'yang-mode "yang-mode" "Major mode for editing YANG modules." t)
(add-to-list 'auto-mode-alist '("\\.yang$" . yang-mode))

;; * * * LuX * * *
(require 'lux-mode)

;; * * * 80 colums * * *
(require 'column-marker)

;; * * * Erlang * * *
(add-to-list 'load-path "~/.emacs.d/erlang")
(add-to-list 'load-path "~/.emacs.d/edts")

(setq load-path (cons  "~/.emacs.d/emacs" load-path))
;; (setq erlang-root-dir "/usr/local/opt/erlang")
;; (setq exec-path (cons "/usr/local/opt/erlang/bin" exec-path))
;; (setq edts-man-root "~/.emacs.d/edts/doc/R16B03")
(require 'erlang-start)

(add-hook 'after-init-hook 'my-after-init-hook)
(defun my-after-init-hook ()
  (require 'edts-start)
  (require 'edts-refactor))

(add-hook 'erlang-mode-hook (lambda () (interactive) (column-marker-1 80)))

;; * * * XML * * *
(defun pretty-print-xml-region (begin end)
  "Pretty format XML markup in region. You need to have nxml-mode
http://www.emacswiki.org/cgi-bin/wiki/NxmlMode installed to do
this.  The function inserts linebreaks to separate tags that have
nothing but whitespace between them.  It then indents the markup
by using nxml's indentation rules."
  (interactive "r")
  (save-excursion
    (nxml-mode)
    (goto-char begin)
    (while (search-forward-regexp "\>[ \\t]*\<" nil t)
      (backward-char) (insert "\n"))
    (indent-region begin end))
  (message "Ah, much better!"))

;; * * * (e)Lisp * * *
(add-to-list 'auto-mode-alist '("\\.emacs$" . lisp-mode))
(add-to-list 'auto-mode-alist '("dot-emacs$" . lisp-mode))

;; * * * Rst * * *
(add-to-list 'auto-mode-alist '("\\.rst$" . rst-mode))

;; * * * Internal functions * * *
;; Auto-complete using open buffers
(defun indent-or-complete ()
  "Complete if point is at end of a word, otherwise indent line."
  (interactive)
  (if (looking-at "\\>")
      (dabbrev-expand nil)
    (indent-for-tab-command)
    ))
(global-set-key (kbd "TAB") 'indent-or-complete)

;; Close all buffers
(defun kill-all-buffers ()
  (interactive)
  (mapc 'kill-buffer (buffer-list)))

;; Insert a timestamp at the end of a file (diary stuff)
(defun insert-date-stamp ()
  "Insert current date at the end of the file position."
  (interactive "*")
  (message "starting to date stamp the line...")
  (setq make-backup-files         nil)
  (end-of-buffer)
  (end-of-line)
  (insert (format-time-string "\n\n%a %b %e %R %Z %Y\n\n" (current-time)))
  ;;(forward-char -1)
  ;;(forward-char 1)
  (end-of-buffer)
  (end-of-line)
  (message "starting to date stamp the line - finished.")
  )

;; * * * Keys * * *

;; Word-walk
(global-set-key "\M-[1;5A" 'backward-paragraph) ;  Ctrl+up->paragraph up
(global-set-key "\M-[1;5B" 'forward-paragraph)  ;  Ctrl+down->paragraph down
(global-set-key "\M-[1;5C" 'forward-word)       ;  Ctrl+right->forward word
(global-set-key "\M-[1;5D" 'backward-word)      ;  Ctrl+left-> backward word

;; Re-mapping Ctrl-Z
(setq ctrl-z-map (make-keymap))
(global-set-key "\C-z" ctrl-z-map)
(global-set-key (kbd "\C-z\C-r") 'rgrep)
(global-set-key "\C-z\C-s" 'tags-apropos)
(global-set-key (kbd "C-z m") 'menu-bar-open)

(global-set-key (kbd "M-g") 'goto-line)

;; * * * Mouse * * *

;; Enable mouse support for nox emacs
(unless window-system
  (require 'mouse)
  (xterm-mouse-mode t)
  (global-set-key [mouse-4] '(lambda ()
                               (interactive)
                               (scroll-down 1)))
  (global-set-key [mouse-5] '(lambda ()
                               (interactive)
                               (scroll-up 1)))
  (defun track-mouse (e))
  (setq mouse-sel-mode t)
)

;; * * * Copy/Paste * * *

;; Copy whatever is selected into the mac os x buffer...
;; (shell-command-on-region (region-beginning) (region-end) "/usr/bin/pbcopy")
(global-set-key (kbd "C-c c") 'pbcopy)

(defun pbcopy ()
  (interactive)
  (call-process-region (point) (mark) "pbcopy")
  (setq deactivate-mark t))

;; * * * README * * *
(find-file "~/README")
(switch-to-buffer "README")

(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(edts-inhibit-package-check t))
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(edts-face-error-line ((t (:background "red")))))
